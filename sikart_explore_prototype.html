<!DOCTYPE html>
<html>
  <head>
    <title>SKIART - Explore (Prototype)</title>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8" />
  
  <script src="js/jquery-2.2.4.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/snap.svg-min.js" type="text/javascript" charset="utf-8"></script>
    
<style>

body {
  background: #ffffff;
  color: #1e1e1e;
}
.primaryColor {
  color: #ffffff;
}
.primaryBg {
  background: #ea0f89;
}
.accentColor {
  color: #ea0f89;
}
.circleBg {
  background: #f9f9f9;
}

#graph {
  width: 1200px;
  height: 1000px;
  border: 1px solid #f9f9f9;
}

</style>
    
</head>
<body>
  <div class="content">
    <svg id="graph">
    </svg>
  </div>
</div>
<script>
var cW = 600;
var cH = 500;
var cR = 150;

var s = Snap('#graph');
var params = $_GET();


createGraph();

function createGraph() {

  s.clear();

  // Radius & Angle
  var er=(cH-cR)/2.2;
  var delta= 2*Math.PI / (params.length);
  var alpha = Math.PI / 3.5;

  // Center Image Settings
  var imgW = 204;
  var imgH = 136
  var imgB = 4;

  var bX = cW - imgW/2;
  var bY = cH + imgH/2 + 15;

  // Iteration through search parameter
  for(var i=0; i < params.length; i++) {
    var x = cW + 2.5 * Math.sin(alpha) * er;
    var y = cH + 2.2 * Math.cos(alpha) * er;
    
    // Circle
    var crcl = s.circle(x,y,cR);
    crcl.attr({
      fill: '#e9e9e9',
      strokeWidth: 0 
    });

    // Line
    var line = s.line(x,y,cW,cH);
    line.attr({
      stroke: '#e9e9e9',
      strokeWidth: 2
    })

    // Text Boxes
    var lX = cW + (x-cW) / 2.1;
    var lY = cH + (y-cH) / 2.1;
    
    var block = s.rect(lX - 50, lY - 15, 100, 40, 4);
    
    block.attr({
      fill: '#ffffff',
      stroke: "#e9e9e9",
      strokeWidth: 2
    });
    
    var text = s.text(lX, lY, params[i]);
    text.attr({
        'font-size': '1em',
        x: lX - (text.node.clientWidth/2) - 10,
        y: lY + (text.node.clientHeight/2),
    });

    block.attr({
        width: (text.node.clientWidth + 50),
        x: lX - (text.node.clientWidth + 50) / 2
    });


    // Text Tags
    bY = (bX + text.node.clientWidth + 30 > cW + imgW/2 ) ? bY + 23 : bY;
    if (bX + text.node.clientWidth + 30 > cW + imgW/2 ){
      bX = cW - imgW/2;
    } 
    console.log(bY);

    var block = s.rect(bX, bY, 100, 20, 4);
    
    block.attr({
      fill: '#ea0f89',
      strokeWidth: 0
    });
    
    var text = s.text(bX + 25, bY, params[i]);
    text.attr({
        'font-size': '0.7em',
        fill: '#ffffff',
        y: bY + (text.node.clientHeight/1.4),
    });

    var l1 = s.line(bX + 8, bY + 6, bX + 16, bY + 14 );
    var l2 = s.line(bX + 8, bY + 14, bX + 16, bY + 6 );
    var close = s.g(l1, l2);
    close
    .attr({
      stroke: '#ffffff',
      strokeWidth: 2
    })
    .click(function() {
      var ix = params.indexOf(this.node.parentNode.childNodes[1].textContent);
      params.splice(ix,1);
      console.log(params);
      createGraph();
    });

    block.attr({
        width: text.node.clientWidth + 30,
    });

    s.g(block, text, close);

    if (bX + block.node.width.baseVal.value <= cW + imgW/2 ){
      bX += block.node.width.baseVal.value + 5;
    }

    // Extend angle
    alpha += delta;
  }

  // Center Image
  var rect = s.rect(cW-imgW/2-imgB, cH-imgH/2-imgB, imgW+imgB*2, imgH+imgB*2, imgB)
  rect.attr({
    stroke: '#e9e9e9',
    strokeWidth: 2,
    'fill-opacity': 0  
  });
  var imgMask = s.rect(cW-imgW/2,cH-imgH/2,imgW,imgH,2);
  imgMask.attr({
    fill: '#fff'
  });
  var img = s.image('img/0_jodeln.jpg',cW-imgW/2,cH-imgH/2,imgW,imgH);
  img.attr({
    mask: imgMask
  });

  // Search Field

}

function getCloseIcon(color) {
  var p_line1 = s.paper.line(0,0, 8,8).attr({stroke: color});
  var p_line2 = s.paper.line(8,0, 0,8).attr({stroke: color});

  var icon = s.paper.g(p_line1, p_line2).pattern(0,0, 8,8); 

  return icon;
}

function $_GET() {
  var vars = [];
  window.location.href.replace( location.hash, '' ).replace( 
    /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
    function( m, key, value ) { // callback
      if (key === 'tags') {
        vars.push(value !== undefined ? value : '');
      } 
    }
  );
  return vars;
}
  
</script>
</body>
</html>